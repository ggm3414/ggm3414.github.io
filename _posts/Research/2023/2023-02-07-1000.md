---
title: "ê°œë°œì¼ì§€ 2023ë…„ 2ì›” 7ì¼ í™”ìš”ì¼"
categories:
  - Research_Daily
tags:
  - UnityC#
  - UniRx
toc: true
toc_sticky: true
toc_label: "ê°œë°œì¼ì§€"
toc_icon: "sticky-note"
---

# ì°¸ê³ ë¬¸í—Œ 1

---

## ì‚¬ì´íŠ¸ 1

- ì¶œì²˜ì‚¬ì´íŠ¸ ğŸ‘‰ [[Unity] Delegate ì§€ì • ì‹œ GC Alloc ë° ì²˜ë¦¬ ì‹œê°„ ê²€ì¦ ê²°ê³¼](https://baba-s.hatenablog.com/entry/2017/08/23/100000){:target="_blank"} **ë§í¬ì— ì ‘ì†** <br> 

ğŸ“Œ **ë¸”ë¡œê·¸** <br>
**ì„¤ëª…** : ì¼ë³¸ì–´ ë¸”ë¡œê·¸<br>
**ë‚´ìš©** : [Unity] Delegate ì§€ì • ì‹œ GC Alloc ë° ì²˜ë¦¬ ì‹œê°„ ê²€ì¦ ê²°ê³¼<br>
{: .notice--info}

- ì¶œì²˜ì‚¬ì´íŠ¸ ğŸ‘‰ [https://softmedia.sakura.ne.jp/advent-calendar/2020/12-12.html/](https://softmedia.sakura.ne.jp/advent-calendar/2020/12-12.html/){:target="_blank"} **ë§í¬ì— ì ‘ì†** <br> 

ğŸ“Œ **ë¸”ë¡œê·¸** <br>
**ì„¤ëª…** : ì¼ë³¸ì–´ ë¸”ë¡œê·¸<br>
**ë‚´ìš©** : "UniTask2"ì™€ í•¨ê»˜ í¸ì•ˆí•œ ìœ ë‹ˆí‹° ë¼ì´í”„ë¥¼ ì¦ê²¨ë³´ì„¸ìš”!<br>
{: .notice--info}

<<<<<<< HEAD
## ì•Œê³ ë¦¬ì¦˜ ì •ë¦¬
### ë§ˆìš°ìŠ¤ í›„í‚¹í•˜ê¸° (ì—°ê²°í•´ì„œ ì“°ê¸°)
```cs
public class MouseManager : MonoBehaviour
{
    WindowMouse m_windowMouse;
    private Queue<Action> _executeOnUpdate;
    public TMPro.TextMeshProUGUI m_textPos;

    #region MonoBehaviour
    private void Awake()
    {
        _executeOnUpdate = new Queue<Action>();

        if (m_windowMouse == null)
            m_windowMouse = new WindowMouse(this);
    }

    void Start()
    {
        if (m_windowMouse != null)
        {
            m_windowMouse.Start(System.Threading.ThreadPriority.Highest);
        }
    }

    void Update()
    {
        //WindowMouse.GetCursorPos(out m_mousePositionUser32);
        //m_x = m_mousePositionUser32.x;
        //m_y = m_mousePositionUser32.y;

        lock (_executeOnUpdate)
        {
            while (_executeOnUpdate.Count > 0)
            {
                _executeOnUpdate.Dequeue().Invoke();
            }
        }
    }

    private void OnDestroy()
    {
        m_windowMouse.m_stopRequested = false;
        m_windowMouse?.StopThread();
    }
    #endregion

    public void ExecuteOnUpdate(Action action)
    {
        lock (_executeOnUpdate)
        {
            _executeOnUpdate.Enqueue(action);
        }
    }
}
```

### ë§ˆìš°ìŠ¤ í›„í‚¹í•˜ê¸° (DllImport í¸)
```cs
public class WindowMouse
{
    private MouseManager m_mouseBase = null;

    [DllImport("User32.Dll")]
    public static extern long SetCursorPos(int x, int y);
    
    [DllImport("User32.Dll")]
    public static extern bool GetCursorPos(out POINT lpPoint);

    [DllImport("user32.dll", SetLastError = false)]
    public static extern IntPtr GetDesktopWindow();
    [DllImport("user32.dll")]
    private static extern void mouse_event(UInt32 dwFlags, UInt32 dx, UInt32 dy, UInt32 dwData, IntPtr dwExtraInfo);
    [DllImport("user32.dll")]
    public static extern short GetAsyncKeyState(UInt16 virtualKeyCode);
    [DllImport("user32.dll")]
    public static extern bool GetWindowRect(IntPtr hWnd, out RECT rect);

    public delegate bool EnumWindowsProc(IntPtr hwnd, IntPtr lparam);

    private const UInt32 MOUSEEVENTF_LEFTDOWN = 0x0002;
    private const UInt32 MOUSEEVENTF_LEFTUP = 0x0004;
    private const UInt32 MOUSEEVENTF_RIGHTDOWN = 0x08;
    private const UInt32 MOUSEEVENTF_RIGHTUP = 0x10;
    private const UInt32 MOUSEEVENTF_MIDDLEDOWN = 0x0020;
    private const UInt32 MOUSEEVENTF_MIDDLEUP = 0x0040;

    const uint MOUSEEVENTF_WHEEL = 0x0800;
    const uint MOUSEEVENTF_HWHEEL = 0x01000;

    //Virtual key codes
    private const UInt16 VK_MBUTTON = 0x04;//middle mouse button
    private const UInt16 VK_LBUTTON = 0x01;//left mouse button
    private const UInt16 VK_RBUTTON = 0x02;//right mouse button

    //----------------------------------------------------------Thread
    public Thread m_thread;
    public bool m_stopRequested;
    //----------------------------------------------------------Thread

    // Send the event Down for the Right Mouse Button
    public static void SendUpLeft() => mouse_event(MOUSEEVENTF_LEFTUP, 0, 0, 0, new System.IntPtr());
    public static void SendUpMiddle() => mouse_event(MOUSEEVENTF_MIDDLEUP, 0, 0, 0, new System.IntPtr());
    public static void SendUpRight() => mouse_event(MOUSEEVENTF_RIGHTUP, 0, 0, 0, new System.IntPtr());
    public static void SendDownLeft() => mouse_event(MOUSEEVENTF_LEFTDOWN, 0, 0, 0, new System.IntPtr());
    public static void SendDownMiddle() => mouse_event(MOUSEEVENTF_MIDDLEDOWN, 0, 0, 0, new System.IntPtr());
    public static void SendDownRight() => mouse_event(MOUSEEVENTF_RIGHTDOWN, 0, 0, 0, new System.IntPtr());

    public static void GetLeftButtonState(out bool isUp) => isUp = GetAsyncKeyState(VK_LBUTTON) == 0;
    public static void GetMiddleButtonState(out bool isUp) => isUp = GetAsyncKeyState(VK_MBUTTON) == 0;
    public static void GetRightButtonState(out bool isUp) => isUp = GetAsyncKeyState(VK_RBUTTON) == 0;

    [StructLayout(LayoutKind.Sequential)]
    public struct POINT
    {
        public int x;
        public int y;

        public POINT(int X, int Y)
        {
            x = X;
            y = Y;
        }
    }

    [StructLayout(LayoutKind.Sequential)]
    public struct RECT
    {
        public int Left;
        public int Top;
        public int Right;
        public int Bottom;
    }

    //----------------------------------------------------------Thread
    private static RECT desktopPos;
    private int Width;
    private int Height;
    //----------------------------------------------------------Thread
    public delegate void MouseEventHandler(POINT _point);
    public event MouseEventHandler OnMousePosition;
    public bool m_error;
    //----------------------------------------------------------Thread

    public WindowMouse(MouseManager _input)
    {
        this.m_mouseBase = _input;
        bool success = InitializeCheck();
        if (success)
        {
            Initialize();
            m_error = false;
        }
        else
        {
            m_error = true;
        }
    }

    public bool InitializeCheck()
    {
        try
        {
            GetWindowRect(GetDesktopWindow(), out desktopPos);

            Debug.Log($"TOP:{desktopPos.Top} BOTTOM:{desktopPos.Bottom} LEFT:{desktopPos.Left} RIGHT:{desktopPos.Right}");
            return true;
        }
        catch (Exception e)
        {
            Debug.LogError(e.Message);
            return false;
        }
    }

    public bool Initialize()
    {
        OnMousePosition += (_point) =>
        {
            m_mouseBase.m_textPos.text = $"X:{_point.x} Y:{_point.y}";
            //Debug.Log($"X:{_point.x} Y:{_point.y}");
        };

        return true;
    }

    private void OnSend(POINT _point)
    {
        m_mouseBase.ExecuteOnUpdate(() =>
        {
            if (OnMousePosition != null)
                OnMousePosition.Invoke(_point);
        });
    }

    public void Start(System.Threading.ThreadPriority priority)
    {
        if (m_error)
            return;

        m_stopRequested = false;
        if (m_thread == null)
        {
            m_thread = new Thread(ThreadFunction);
            m_thread.Priority = priority;
            m_thread.Start();
        }
    }

    private void ThreadFunction(object obj)
    {
        while (!m_stopRequested)
        {
            POINT cursorPos = new POINT();
            GetCursorPos(out cursorPos);
            OnSend(cursorPos);
            Thread.Sleep(500);
        }
    }

    public void StopThread()
    {
        if (m_thread != null)
        {
            m_stopRequested = true;
            m_thread.Abort();
            m_thread = null;
        }
    }
}
=======
```json
"com.atteneder.draco": "https://github.com/atteneder/DracoUnity.git#v4.0.2",
"com.atteneder.gltfast": "https://github.com/atteneder/glTFast.git#v5.0.0",
"com.atteneder.ktx": "https://github.com/atteneder/KtxUnity.git#v2.2.3",
"com.cysharp.unitask": "https://github.com/Cysharp/UniTask.git?path=src/UniTask/Assets/Plugins/UniTask#2.3.3",
"com.mochineko.stbimagesharp-for-unity": "https://github.com/mochi-neko/StbImageSharpForUnity.git?path=/Assets/Mochineko/StbImageSharpForUnity",
"com.neuecc.unirx": "https://github.com/neuecc/UniRx.git?path=Assets/Plugins/UniRx/Scripts",
"com.stbsharp.stbimagesharp": "https://github.com/mochi-neko/StbImageSharpForUnity.git?path=/Assets/StbImageSharp",
>>>>>>> 7ef68ca37448b50470793c0273b4fd810c2f5ef9
```

---
<!--
## ì‚¬ì´íŠ¸ 2

- ì¶œì²˜ì‚¬ì´íŠ¸ ğŸ‘‰ [https://qiita.com/toRisouP/items/3ced60a755ab297eb463](https://qiita.com/toRisouP/items/3ced60a755ab297eb463){:target="_blank"} **ë§í¬ì— ì ‘ì†** <br> 

ğŸ“Œ **ë¸”ë¡œê·¸** <br>
**ì„¤ëª…** : ì¼ë³¸ì–´ ë¸”ë¡œê·¸<br>
**ë‚´ìš©** : UniRx&UniTaskë€?<br>
{: .notice--info}

## ì‚¬ì´íŠ¸ 3

- ì¶œì²˜ì‚¬ì´íŠ¸ ğŸ‘‰ [https://speakerdeck.com/torisoup/unitask2020?slide=49](https://speakerdeck.com/torisoup/unitask2020?slide=49){:target="_blank"} **ë§í¬ì— ì ‘ì†** <br> 
- ì¶œì²˜ì‚¬ì´íŠ¸ ğŸ‘‰ [https://qiita.com/toRisouP/items/8f66fd952eaffeaf3107](https://qiita.com/toRisouP/items/8f66fd952eaffeaf3107){:target="_blank"} **ë§í¬ì— ì ‘ì†** <br> 

ğŸ“Œ **ë¸”ë¡œê·¸** <br>
**ì„¤ëª…** : ì¼ë³¸ì–´ íŒŒì›Œí¬ì¸íŠ¸ ëª¨ìŒ ì‚¬ì´íŠ¸<br>
**ë‚´ìš©** : UniTask ì‚¬ìš©ë²• 2020 / UniTask2020 ë‚´ìš©ì´ ì¢‹ë‹¤.<br>
{: .notice--info}


![image](https://media.giphy.com/media/QKZfbgNK9oFkQ/giphy.gif){: .align-center}

https://speakerdeck.com/torisoup/unityniokerushe-ji-patan?slide=65
https://qiita.com/dwl/items/9b9f51e404a8682c553b
https://qiita.com/RYA234/items/ba73e6c37f1c39b1aeba

## ì‚¬ì´íŠ¸ 2
- [í•˜ë‚˜ì¹˜ë£¨ì˜ ë‚´ ë…¸íŠ¸](https://www.hanachiru-blog.com/search?q=Unitask){:target="_blank"} **ë§í¬ì— ì ‘ì†** <br> 

ğŸ“Œ **ë¸”ë¡œê·¸** <br>
**ì„¤ëª…** : ì¼ë³¸ì–´ ë¸”ë¡œê·¸<br>
**ë‚´ìš©** : C#, Unity, Shader, UniRx<br>
{: .notice--info}

## ì‚¬ì´íŠ¸ 3
- [UniRx ì•ˆí‹° íŒ¨í„´ ì»¬ë ‰ì…˜](https://qiita.com/toRisouP/items/91b7860af5e3eab037fc){:target="_blank"} **ë§í¬ì— ì ‘ì†** <br>

ğŸ“Œ **ë¸”ë¡œê·¸** <br>
**ì„¤ëª…** : ì¼ë³¸ì–´ ë¸”ë¡œê·¸<br>
**ë‚´ìš©** : Qiita ì‚¬ì´íŠ¸ ë¸”ë¡œê·¸<br>
{: .notice--info}




ğŸ“Œ **ë¸”ë¡œê·¸** <br>
**ì„¤ëª…** : ì¼ë³¸ì–´ ë¸”ë¡œê·¸<br>
**ë‚´ìš©** : C#, Unity, Shader, UniRx<br>
{: .notice--info}



ğŸ”” **í¬ìŠ¤íŒ… ê³µì§€** <br><br>
í˜„ì¬ ì‘ì„±í•œ í¬ìŠ¤íŒ…ì€ **ê¹ƒ ë¸”ë¡œê·¸ ì‹œì‘ ì„¸íŒ…**ê³¼ ê´€ë ¨ëœ ë‚´ìš©ì…ë‹ˆë‹¤.<br>
minimal-mistakes í…Œë§ˆì˜ ì»¤ìŠ¤í„°ë§ˆì´ì§• ë° í¬ìŠ¤íŒ…ì— ê´€í•´ì„œë„ ì§„í–‰í•  ì˜ˆì •ì´ë‹ˆ, 
**Github_Blog ì¹´í…Œê³ ë¦¬**ë¥¼ í´ë¦­í•˜ì…”ì„œ í™•ì¸í•´ë³´ì„¸ìš”!<br>
{: .notice--success}    //ë…¹ìƒ‰
{: .notice--primary}    //íšŒìƒ‰
{: .notice--info}       //íŒŒë‘
{: .notice--warning}    //ë…¸ë‘
{: .notice--danger}     //ë¹¨ê°•
-->
