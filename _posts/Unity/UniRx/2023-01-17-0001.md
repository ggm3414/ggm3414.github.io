---
title: "[UniRx] UniRx ê¸°ë¡ 1"
categories:
  - UniRx
tags:
  - UnityC#
  - UniRx
toc: true
toc_sticky: true
toc_label: "UniRx ê¸°ë¡ 1"
toc_icon: "sticky-note"
---

# ì°¸ê³  ë¬¸í—Œ

ğŸ”º [UniRxå…¥é–€ ãã®1](https://qiita.com/toRisouP/items/2f1643e344c741dd94f8){:target="_blank"} ì›ë³¸ ë§í¬. <br>
- <https://qiita.com/toRisouP/items/2f1643e344c741dd94f8> <br>

ğŸ”º [UniRx ì…ë¬¸ 1](https://tech.lonpeach.com/2019/11/03/UniRx-Getting-Started-1/){:target="_blank"} ì›ë³¸ êµ¬ê¸€ë²ˆì—­ ë§í¬. <br>
- <https://tech.lonpeach.com/2019/11/03/UniRx-Getting-Started-1/> <br>

# 1. "eventì™€ UniRx"

### í…Œì´ë¸” êµ¬ì„±
  * [Event](#TimeCounter.cs)

```cs
using System.Collections;
using UnityEngine;

/// <summary>
/// 100ì—ì„œ ì¹´ìš´íŠ¸ ë‹¤ìš´ ê°’ì„ ë³´ê³ í•˜ëŠ” ìƒ˜í”Œ
/// </summary>
public class TimeCounter : MonoBehaviour
{
    /// <summary>
    /// ì´ë²¤ã…Œ í•¸ë“¤ëŸ¬ (ì´ë²¤íŠ¸ ë©”ì‹œì§€ì˜ í˜•ì‹ ì •ì˜)
    /// </summary>
    public delegate void TimerEventHandler(int time);

    /// <summary>
    /// ì´ë²¤íŠ¸
    /// </summary>
    public event TimerEventHandler OnTimeChanged;

    private void Start()
    {
        // íƒ€ì´ë¨¸ ì‹œì‘
        StartCoroutine(TimerCoroutine());        
    }

    private IEnumerator TimerCoroutine()
    {
        // 100ì—ì„œ ì¹´ìš´íŠ¸ ë‹¤ìš´
        var time = 100;
        while (time > 0)
        {
            time--;

            // ì´ë²¤íŠ¸ ì•Œë¦¼
            OnTimeChanged(time);

            // 1ì´ˆ ê¸°ë‹¤ë¦¬ëŠ”
            yield return new WaitForSeconds(1);
        }
    }
}
```

  * [Event](#TimerView.cs)

```cs
using UnityEngine;
using UnityEngine.UI;

public class TimerView : MonoBehaviour
{
    // ê° ì¸ìŠ¤í„´ìŠ¤ëŠ” ì¸ìŠ¤í™í„°ì—ì„œ ì„¤ì •
    [SerializeField] private TimeCounter timeCounter;
    [SerializeField] private Text counterText; // UGUIì˜ Text

    private void Start()
    {
        // íƒ€ì´ë¨¸ ì¹´ìš´í„°ê°€ ë³€í™”í•œ ì´ë²¤íŠ¸ë¥¼ ë°›ê³  UGUI Textë¥¼ ì—…ë°ì´íŠ¸
        timeCounter.OnTimeChanged += time => // "=>" ëŠ” ëŒë‹¤ì‹ì´ë¼ëŠ” ìµëª… í•¨ìˆ˜ í‘œê¸°ë²• 
        {
            // í˜„ì¬ íƒ€ì´ë¨¸ ê°’ì„ UIì— ë°˜ì˜
            counterText.text = time.ToString();
        };
    }
}
```

***

  * [UniRx](#TimeCounterRx.cs)

```cs
using System;
using System.Collections;
using UniRx;
using UnityEngine;

/// <summary>
/// 100ì—ì„œ ì¹´ìš´íŠ¸ ë‹¤ìš´í•˜ê³  Debug.Logì— ê·¸ ê°’ì„ í‘œì‹œí•˜ëŠ” ìƒ˜í”Œ
/// </summary>
public class TimeCounterRx : MonoBehaviour
{
    // ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•˜ëŠ” í•µì‹¬ ì¸ìŠ¤í„´ìŠ¤
    private Subject<int> timerSubject = new Subject<int>();

    // ì´ë²¤íŠ¸ì˜ êµ¬ë…ìë§Œ ê³µê°œ
    public IObservable<int> OnTimeChanged => timerSubject;

    private void Start() => StartCoroutine(TimerCoroutine());

    private IEnumerator TimerCoroutine()
    {
        // 100ì—ì„œ ì¹´ìš´íŠ¸ ë‹¤ìš´
        var time = 100;
        while (time > 0)
        {
            time--;

            // ì´ë²¤íŠ¸ë¥¼ ë°œí–‰
            timerSubject.OnNext(time);

            // 1ì´ˆ ê¸°ë‹¤ë¦¬ëŠ”
            yield return new WaitForSeconds(1);
        }
    }
}
```

  * [UniRx](#TimerViewRx)

```cs
using UnityEngine;
using UnityEngine.UI;
using UniRx;

public class TimerViewRx : MonoBehaviour
{
    // ê° ì¸ìŠ¤í„´ìŠ¤ëŠ” ì¸ìŠ¤í™í„°ì—ì„œ ì„¤ì •
    [SerializeField] private TimeCounterRx timeCounter;
    [SerializeField] private Text counterText; // UGUIì˜ Text

    private void Start() =>
        // íƒ€ì´ë¨¸ ì¹´ìš´í„°ê°€ ë³€í™”í•œ ì´ë²¤íŠ¸ë¥¼ ë°›ê³  UGUI Textë¥¼ ì—…ë°ì´íŠ¸
        timeCounter.OnTimeChanged.Subscribe(time =>
        {
            // í˜„ì¬ íƒ€ì´ë¨¸ ê°’ì„ uiì— ë°˜ì˜
            counterText.text = time.ToString();
        });
}
```
***
## 2. "OnNextì™€ Subscribe"
```cs
private void Start()
{
    // Subject ì‘ì„±
    Subject<string> subject = new Subject<string>();

    // 3íšŒ Subscrbie
    subject.Subscribe(msg => Debug.Log("Subscribe1 : " + msg));
    subject.Subscribe(msg => Debug.Log("Subscribe2 : " + msg));
    subject.Subscribe(msg => Debug.Log("Subscribe3 : " + msg));

    // ì´ë²¤íŠ¸ ë©”ì‹œì§€ ë°œí–‰
    subject.OnNext("ì•ˆë…•í•˜ì„¸ìš”");
    subject.OnNext("ì•ˆë…•");
}
```
```
Subscribe1 : ì•ˆë…•í•˜ì„¸ìš”
Subscribe2 : ì•ˆë…•í•˜ì„¸ìš”
Subscribe3 : ì•ˆë…•í•˜ì„¸ìš”
Subscribe1 : ì•ˆë…•
Subscribe2 : ì•ˆë…•
Subscribe3 : ì•ˆë…•
```
***
## 4. "IObserverì™€ IObservable"
***
## (ë³´ì¶©) Subscribeì˜ ìƒëµ í˜¸ì¶œ
```
// OnNextë§Œ
subject.Subscribe(msg => Debug.Log("Subscribe1:" + msg));

// OnNext & OnError
subject.Subscribe(
    msg => Debug.Log("Subscribe1:" + msg),
    error => Debug.LogError("Error" + error));

// OnNext & OnCompleted
subject.Subscribe(
    msg => Debug.Log("Subscribe1:" + msg),
    () => Debug.Log("Completed"));

// OnNext & OnError & OnCompleted
subject.Subscribe(
    msg => Debug.Log("Subscribe1:" + msg),
    error => Debug.LogError("Error" + error),
    () => Debug.Log("Completed"));
```
***
## í•„í„°ë§ ìš´ì˜ì "Where"
```cs
// ë¬¸ìì—´ì„ ë°œí–‰í•˜ëŠ” Subject
Subject<string> subject = new Subject<string>();

// Enemyë§Œ í•„í„°ë§
subject
    .Where(x => x == "Enemy") // í•„í„°ë§ ì˜¤í¼ë ˆì´í„°
    .Subscribe(x => Debug.Log($"í”Œë ˆì´ì–´ê°€ {x}ì— ì¶©ëŒí–ˆìŠµë‹ˆë‹¤."));

// ì´ë²¤íŠ¸ ë©”ì‹œì§€ ë°œê¸‰
// í”Œë ˆì´ì–´ê°€ ì–¸ê¸‰í•œ ê°œì²´ì˜ Tagê°€ ë°œí–‰ë˜ì—ˆë‹¤ëŠ” ê°€ì •
subject.OnNext("Wall");
subject.OnNext("Wall");
subject.OnNext("Enemy");
subject.OnNext("Enemy");
```
```
í”Œë ˆì´ì–´ê°€ Enemyì— ì¶©ëŒí–ˆìŠµë‹ˆë‹¤.
í”Œë ˆì´ì–´ê°€ Enemyì— ì¶©ëŒí–ˆìŠµë‹ˆë‹¤.
```
***

## ë‹¤ì–‘í•œ ì˜¤í¼ë ˆì´í„°
- í•„í„°ë§ "Where"
- ë©”ì‹œì§€ ë³€í™˜ "Select"
- ì¤‘ë³µì„ ì œê±°í•˜ëŠ” "Distinct"
- ì¼ì • ê°œìˆ˜ê°€ ì˜¬ë•Œê¹Œì§€ ëŒ€ê¸°í•˜ëŠ” "Buffer"
- ë‹¨ì‹œê°„ì— í•¨ê»˜ ì˜¨ ê²½ìš° ì²˜ìŒë§Œ ì‚¬ìš©í•˜ëŠ” "ThrottleFirst"
***

## í•„í„°ë§ ì˜¤í¼ë ˆì´í„° êµ¬í˜„
```cs
using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

/// <summary>
/// í•„í„°ë§ ì˜¤í¼ë ˆì´í„°
/// </summary>
public class MyFilter<T> : IObservable<T>
{
    /// <summary>
    /// ìƒë¥˜ê°€ ë˜ëŠ” Observable
    /// </summary>
    private IObservable<T> _source;

    /// <summary>
    /// íŒì •ì‹
    /// </summary>
    private Func<T, bool> _conditionalFunc;

    public MyFilter(IObservable<T> source, Func<T, bool> conditionalFunc)
    {
        _source = source;
        _conditionalFunc = conditionalFunc;
    }
    
    public IDisposable Subscribe(IObserver<T> observer)
    {
        // Subscribeë˜ë©´ MyFilterOperator ë³¸ì²´ë¥¼ ë§Œë“¤ì–´ ë°˜í™˜í•œë‹¤.
        return new MyFilterInternal(this, observer).Run();
    }
    
    // Observerë¡œ MyFilterInternalì´ ì‹¤ì œë¡œ ì‘ë™í•˜ëŠ” ê³³
    private class MyFilterInternal : IObserver<T>
    {
        private MyFilter<T> _parent;
        private IObserver<T> _observer;
        private object _lockObject = new object();

        public MyFilterInternal(MyFilter<T> parent, IObserver<T> observer)
        {
            _parent = parent;
            _observer = observer;
        }

        public IDisposable Run()
        {
            return _parent._source.Subscribe(this);
        }

        public void OnNext(T value)
        {
            lock (_lockObject)
            {
                if (_observer == null)
                {
                    return;
                }

                try
                {
                    // ê°™ì€ ê²½ìš°ì—ë§Œ OnNextë¥¼ í†µê³¼
                    if (_parent._conditionalFunc(value))
                    {
                        _observer.OnNext(value);
                    }
                }
                catch (Exception e)
                {
                    // ë„ì¤‘ì— ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ì—ëŸ¬ë¥¼ ì „ì†¡
                    _observer.OnError(e);
                    _observer = null;
                }
            }
        }

        public void OnError(Exception error)
        {
            lock (_lockObject)
            {
                // ì˜¤ë¥˜ë¥¼ ì „íŒŒí•˜ê³  ì •ì§€
                _observer.OnError(error);
                _observer = null;
            }
        }
        
        public void OnCompleted()
        {
            lock (_lockObject)
            {
                // ì •ì§€
                _observer.OnCompleted();
                _observer = null;
            }
        }
    }
}
```

- C# lock ë¸”ëŸ­
- C# Interlocked
- C# ì˜ˆì™¸ì²˜ë¦¬

***
## ì‚¬ìš©ì„±ì„ ê³ ë ¤í•˜ì—¬ í™•ì¥ ë©”ì„œë“œ ì‘ì„±
```cs
using System;

public static class ObservableOperators
{
    public static IObservable<T> FilterOperator<T>(this IObservable<T> source, Func<T, bool> conditionalFunc) 
        => new MyFilter<T>(source, conditionalFunc);
} 
```
```cs
private void Start()
{
    // ë¬¸ìì—´ì„ ë°œí–‰í•˜ëŠ” Subject 
    Subject<string> subject = new Subject<string>();

    // filterë¥¼ ë¼ê³  Subscribe ë³´ë©´ 
    subject
        .FilterOperator(x => x == "Enemy")
        .Subscribe(x => Debug.Log(string.Format("í”Œë ˆì´ì–´ê°€ {0}ì— ì¶©ëŒí–ˆìŠµë‹ˆë‹¤", x)));

    // ì´ë²¤íŠ¸ ë©”ì‹œì§€ ë°œê¸‰ 
    // í”Œë ˆì´ì–´ê°€ ì–¸ê¸‰ í•œ ê°œì²´ì˜ Tagê°€ ë°œí–‰ë˜ì–´, ê°™ì€ ê°€ì • 
    subject.OnNext("Wall");
    subject.OnNext("Wall");
    subject.OnNext("Enemy");
    subject.OnNext("Enemy");
}
```
```
í”Œë ˆì´ì–´ê°€ Enemyì— ì¶©ëŒí–ˆìŠµë‹ˆë‹¤
í”Œë ˆì´ì–´ê°€ Enemyì— ì¶©ëŒí–ˆìŠµë‹ˆë‹¤
```

<!--
ğŸ“£<br>
**Beakjoon**ì—ì„œ PASSëœ ì½”ë“œë§Œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.<br>
ì•Œê³ ë¦¬ì¦˜ì„ ë¨¼ì € í’€ì´í•˜ëŠ” ì–¸ì–´(Java)ê°€ ì •í•´ì ¸ìˆì–´, 
í’€ì´ ì–¸ì–´(Python, C++, Java)ê°€ ëª¨ë‘ ì—…ë°ì´íŠ¸ë  ë•Œê¹Œì§€ëŠ” ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
{: .notice--primary}

ğŸ“Œ **ì‘ì„±ì ê°œë°œ í™˜ê²½** <br>
**OS** : Windows 10<br>
{: .notice--primary}
-->

<!-- 

|  ì–¸ì–´  | Markdown | ì–¸ì–´ | Markdown |
| :---: | :---: | :---: | :---: |
| Bash | bash | JSON | json |
| C# | cs | Java | java |
| C++ | cpp | JavaScript | javascript |
| CSS | css | PHP | php |
| Diff | diff | Perl | perl |
| HTML, XML | html | Python | python |
| HTTP | http | Ruby | ruby |
| Ini | ini | SQL | sql |

<br>

***
___
___

---

-->

<!-- 
ì–¸ì–´ | Markdown | ì–¸ì–´ | Markdown
---|:---:|:---:|---:
Bash | bash | JSON | json

  ê°’ | ì˜ë¯¸ | ê¸°ë³¸ê°’
---|:---:|---:
`static` | ìœ í˜•(ê¸°ì¤€) ì—†ìŒ / ë°°ì¹˜ ë¶ˆê°€ | `static`
`relative` | ìš”ì†Œ **ìì‹ ** ê¸°ì¤€ìœ¼ë¡œ ë°°ì¹˜ |
`absolute` | ìœ„ì¹˜ ìƒ **_ë¶€ëª¨_(ì¡°ìƒ)ìš”ì†Œ** ê¸°ì¤€ìœ¼ë¡œ ë°°ì¹˜ |
`fixed` | **ë¸Œë¼ìš°ì € ì°½** ê¸°ì¤€ìœ¼ë¡œ ë°°ì¹˜ |

  A (ê¸°ë³¸ ì™¼ìª½ ì •ë ¬) | B (ê°€ìš´ë° ì •ë ¬) | C (ì˜¤ë¥¸ìª½ ì •ë ¬)
---|:---:|---:
`1` | ê°€ë‚˜ë‹¤ë¼ | abc
`2` | ê°€ë‚˜ë‹¤ë¼ë§ˆ | abcd
`3` | ê°€ë‚˜ë‹¤ë¼ë§ˆë°” | abcde
`4` | ê°€ë‚˜ë‹¤ë¼ë§ˆë°”ì‚¬ | abcdef

ì–¸ì–´  Markdown  ì–¸ì–´  Markdown
Bash  bash  JSON  json
C#  cs  Java  java
C++ cpp JavaScript  javascript
CSS css PHP php
Diff  diff  Perl  perl
HTML, XML html  Python  python
HTTP  http  Ruby  ruby
Ini ini SQL sql

<div align=right>(ğŸ”ºë§ì´ ì°¸ê³ í–ˆë˜ ê³µì‹ í™ˆí˜ì´ì§€ì…ë‹ˆë‹¤! ì›ë¬¸ì´ë¼ ë‚¯ì„¤ì§€ë§Œ ì™ ë§Œí•œê±´ ë‹¤ ì í˜€ìˆìŠµë‹ˆë‹¤.)</div>
<br>

# H1
## H2
### H3
#### H4
##### H5
###### H6

> first blockqute
>> second blockqute
>>> third blockqute

*single asterisks* - ê¸°ìš¸ì„ì²´
_single underscores_ - ê¸°ìš¸ì„ì²´
**double asterisks** - êµµì€ê¸€ì”¨ì²´
__double underscores__ - ê¸°ìš¸ì„ì²´/êµµì€ê¸€ì”¨ì²´
***triple underscores*** - ê¸°ìš¸ì„ì²´/êµµì€ê¸€ì”¨ì²´
~~cancelline~~ - ì·¨ì†Œì¤„


- [minimal-mistakes theme ê³µì‹ í™ˆí˜ì´ì§€](https://mmistakes.github.io/minimal-mistakes/)
- [minimal-mistakes ê°€ì´ë“œ](https://mmistakes.github.io/minimal-mistakes/docs/quick-start-guide/)
- [minimal-mistakes Github Link](https://github.com/mmistakes/minimal-mistakes)

<br>
<b><u><span style="font-size:20px">ë¬¸ì œ</span></u></b>

ë‘ ì •ìˆ˜ Aì™€ Bë¥¼ ì…ë ¥ë°›ì€ ë‹¤ìŒ, A+Bë¥¼ ì¶œë ¥í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•˜ì‹œì˜¤.

<br>
<b><u><span style="font-size:20px">ì…ë ¥</span></u></b>

ì²«ì§¸ ì¤„ì— Aì™€ Bê°€ ì£¼ì–´ì§„ë‹¤. (0 < A, B < 10)

<br>
<b><u><span style="font-size:20px">ì¶œë ¥</span></u></b>

ì²«ì§¸ ì¤„ì— A+Bë¥¼ ì¶œë ¥í•œë‹¤.

<br>
<br>

# ë¬¸ì œ í’€ì´

---

ê¹Šê²Œ ì„¤ëª…í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤ ğŸ˜€<br>
ì •ìˆ˜ëŠ” ë‘ê°œê°€ ì…ë ¥ë˜ë©°, ì´ ê²°ê³¼ë¥¼ í•œ ì¤„ì— ì¶œë ¥í•˜ë©´ ë©ë‹ˆë‹¤.<br>

<br>
<br>

# ë¬¸ì œ ì½”ë“œ

## C# ì½”ë“œ "event ì™€ UniRx"

<script src="https://gist.github.com/eona1301/ffc5be1f747f3833d2eba0b4c98fa310.js"></script>

2ë²ˆ ë¼ì¸ì€ string listë¥¼ int listë¡œ ë³€ê²½í•´ì£¼ëŠ” ì½”ë“œì…ë‹ˆë‹¤.<br>

## C++

<script src="https://gist.github.com/eona1301/e9e90dcd958e17e20f24a444bd96c2b7.js"></script>

## Java

<script src="https://gist.github.com/eona1301/9856371899c367462a8b4df8cdff3fc4.js"></script>

<br>
<br>

# ì œì¶œ ê²°ê³¼


![image](https://user-images.githubusercontent.com/45550607/107748563-9a6a2b00-6d5c-11eb-98fc-dadb97e1b8b6.png){: .image-center}
-->